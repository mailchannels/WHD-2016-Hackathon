<?php
/**
 * Created by PhpStorm.
 * User: mike
 * Date: 2016-03-13
 * Time: 4:00 PM
 */

echo $this->renderTabs($this->tabs);

// TODO: Can we use the URL helper?
$entryPoint  = !empty($_SERVER['REQUEST_SCHEME']) ? $_SERVER['REQUEST_SCHEME'] : 'http';
$entryPoint .= '://' . $_SERVER['HTTP_HOST'];
$entryPoint .=  '/modules/harvard/public/index.php';
$entryPoint .= '?auth_token=' . $this->token;

?>

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">-->
<style>
    .form-inline label,
    .form-label {
        display: inline-block;
        font-size: .8em;
    }
    .btn {
        border-radius: 3px;
        background-color: white;
        border-color: lightgray;
    }
    thead td {
        padding-right: 8px;
        padding-bottom: 8px;
    }
    thead tr {
        vertical-align: bottom;
    }
    tbody td {
        padding: 5px 0px;
        padding-left: 9px;
    }
    section {
        background-color: #f8f8f8;
        padding: 10px 20px;
        margin-bottom: 10px;
        border: solid 1px #e8e8e8;
        border-radius: 3px;
    }

</style>
<h3><?php echo $this->lmsg('settings-api') ?></h3>
<section>
    <form method="post" action="<?php echo $this->url(array('controller' => 'index', 'action' => 'genkey')); ?>">
        <span class="form-label"><?php echo $this->lmsg('api-key') ?></span>
        <p>
            <?php echo $this->token; ?>
            <button type="submit" class="btn"><?php echo $this->lmsg('generate-api-key') ?></button>
        </p>
    </form>

    <span class="form-label"><?php echo $this->lmsg('webhook-endpoint') ?></span>
    <p><?php echo $entryPoint; ?></p>
</section>

<h3><?php echo $this->lmsg('event-actions') ?></h3>
<section>
    <form class="form-inline" action="<?php echo $this->url(array('controller' => 'index', 'action' => 'addAction')); ?>" method="post">
        <table>
            <tbody>
            <tr>
                <td>
                    <label for="select-event">
                        <?php echo $this->lmsg('select-event') ?>
                    </label>
                    <br/>
                    <select name="event" id="select-event">
                        <option value="*"><?php echo $this->lmsg('select-event-all') ?></option>
                        <option value="tag_test"><?php echo $this->lmsg('select-event-spam') ?></option>
                        <option><?php echo $this->lmsg('select-event-invalid-recipients') ?></option>
                        <option><?php echo $this->lmsg('select-event-complaints') ?></option>
                    </select>
                </td>
                <td>
                    <label for="select-action">
                         <?php echo $this->lmsg('select-action') ?>
                    </label>
                    <br/>
                    <select name="action" id="select-action">
                        <!--
                                    <option>Throttle Sender</option>
                                    <option>Throttle Domain</option>
                                    <option><?php echo $this->lmsg('select-action-block-sender') ?></option>
                        -->
                        <option><?php echo $this->lmsg('select-action-block-domain') ?></option>
                    </select>
                </td>
                <td>
                    <button class="btn btn-default" type="submit"><?php echo $this->lmsg('add-action') ?></button>
                </td>
            </tr>

            <?php

            foreach ($this->actionConfig as $item) {
                echo "<tr>";
                echo sprintf("<td>%s</td><td>%s</td>", $item['event'], $item['action']);
                echo "</tr>";
            }
            ?>
            </tbody>
        </table>
    </form>
</section>
